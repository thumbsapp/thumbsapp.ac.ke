<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>ThumbsApp ¬∑ ultimate gaming arena</title>
  <!-- Google Fonts & Font Awesome -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* === RESET & GLOBAL VARIABLES (merged from three sources) === */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --background: 210 40% 98%;
      --foreground: 222 47% 11%;
      --primary: 217 91% 60%;
      --accent: 262 83% 58%;
      --success: 142 71% 45%;
      --warning: 38 92% 50%;
      --destructive: 0 84% 60%;
      --muted: 210 40% 96%;
      --border: 214 32% 91%;
      --radius: 1rem;
      --header-height: 70px;
      --transition: all 0.2s ease;
      --bg-card: #ffffff;
      --text-secondary: #6b7280;
    }
    .dark {
      --background: 222 47% 11%;
      --foreground: 210 40% 98%;
      --muted: 217 33% 17%;
      --border: 217 33% 17%;
      --bg-card: #1e293b;
      --text-secondary: #94a3b8;
    }
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      line-height: 1.5;
      transition: background-color 0.3s, color 0.3s;
      min-height: 100vh;
      padding-top: var(--header-height);
    }
    .dark body { background-color: #0f172a; }
    .container { max-width: 1440px; margin: 0 auto; padding: 0 1.5rem; }

    /* === HEADER (unified) === */
    .header {
      position: fixed; top: 0; left: 0; right: 0; height: var(--header-height);
      background: hsl(var(--background) / 0.8); backdrop-filter: blur(12px);
      border-bottom: 1px solid hsl(var(--border));
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; z-index: 1000;
    }
    .logo-area { display: flex; align-items: center; gap: 2rem; }
    .logo {
      font-size: 2rem; font-weight: 800; cursor: pointer;
      background: linear-gradient(to right, hsl(var(--primary)), hsl(var(--accent)));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .search-bar {
      background: hsl(var(--muted)); border-radius: 2rem; padding: 0.5rem 1rem;
      display: flex; align-items: center; gap: 0.5rem; border: 1px solid hsl(var(--border));
      width: 300px; transition: var(--transition);
    }
    .search-bar:focus-within { border-color: hsl(var(--primary)); box-shadow: 0 0 0 3px hsl(var(--primary) / 0.2); }
    .search-bar input {
      background: transparent; border: none; outline: none; color: hsl(var(--foreground)); width: 100%;
    }
    .nav-menu { display: flex; align-items: center; gap: 0.5rem; }
    .nav-item {
      padding: 0.5rem 1rem; border-radius: 0.8rem; cursor: pointer; font-weight: 500;
      color: var(--text-secondary); transition: var(--transition);
    }
    .nav-item:hover, .nav-item.active { background: hsl(var(--muted)); color: hsl(var(--primary)); }
    .user-menu { display: flex; align-items: center; gap: 1.2rem; position: relative; }
    .icon-btn {
      background: hsl(var(--muted)); border: 1px solid hsl(var(--border)); border-radius: 50%;
      width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: var(--text-secondary); position: relative;
    }
    .icon-btn:hover { border-color: hsl(var(--primary)); color: hsl(var(--primary)); }
    .badge {
      position: absolute; top: -5px; right: -5px; background: hsl(var(--destructive));
      color: white; font-size: 0.7rem; width: 18px; height: 18px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
    }
    .avatar {
      width: 42px; height: 42px; border-radius: 50%;
      background: linear-gradient(to right, hsl(var(--primary)), hsl(var(--accent)));
      display: flex; align-items: center; justify-content: center; color: white;
      font-weight: 600; cursor: pointer; border: 2px solid transparent;
    }
    .avatar:hover { border-color: hsl(var(--primary)); transform: scale(1.05); }
    .avatar.small { width: 36px; height: 36px; font-size: 0.9rem; }
    .dropdown {
      position: absolute; top: calc(100% + 0.8rem); right: 0; background: var(--bg-card);
      border-radius: 0.8rem; border: 1px solid hsl(var(--border)); min-width: 260px;
      opacity: 0; visibility: hidden; transform: translateY(-10px); transition: var(--transition);
      z-index: 1001; box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.2);
    }
    .dropdown.show { opacity: 1; visibility: visible; transform: translateY(0); }
    .dropdown-item {
      padding: 0.9rem 1.2rem; display: flex; align-items: center; gap: 0.8rem;
      cursor: pointer; border-bottom: 1px solid hsl(var(--border)); color: hsl(var(--foreground));
    }
    .dropdown-item:last-child { border-bottom: none; }
    .dropdown-item:hover { background: hsl(var(--muted)); color: hsl(var(--primary)); }
    .theme-dot { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; }
    .theme-dot.blue { background: #3b82f6; }
    .theme-dot.pink { background: #ec4899; }
    .theme-dot.green { background: #10b981; }

    /* === MAIN GRID (three‚Äëcolumn layout) === */
    .main-grid {
      display: grid; grid-template-columns: 280px 1fr 320px; gap: 1.5rem;
      padding: 1.5rem; min-height: calc(100vh - var(--header-height));
    }
    @media (max-width: 1200px) { .main-grid { grid-template-columns: 240px 1fr; } .right-sidebar { display: none; } }
    @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; } .left-sidebar { display: none; } }

    /* === SIDEBARS === */
    .sidebar {
      background: var(--bg-card); border-radius: var(--radius); border: 1px solid hsl(var(--border));
      padding: 1.5rem; height: fit-content; position: sticky; top: calc(var(--header-height) + 1.5rem);
      backdrop-filter: blur(8px);
    }
    .sidebar-title { font-size: 0.9rem; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 1.2rem; font-weight: 600; }
    .sidebar-item {
      display: flex; align-items: center; gap: 0.8rem; padding: 0.8rem; border-radius: 0.8rem;
      cursor: pointer; transition: var(--transition); margin-bottom: 0.2rem;
    }
    .sidebar-item:hover { background: hsl(var(--muted)); color: hsl(var(--primary)); }
    .sidebar-item i { width: 22px; color: hsl(var(--primary)); }
    .badge.side { background: hsl(var(--primary)); color: white; font-size: 0.7rem; padding: 0.2rem 0.6rem; border-radius: 1rem; margin-left: auto; }

    /* === FEED CARDS === */
    .feed { display: flex; flex-direction: column; gap: 1.25rem; }
    .card {
      background: var(--bg-card); border-radius: var(--radius); border: 1px solid hsl(var(--border));
      padding: 1.5rem; transition: var(--transition); backdrop-filter: blur(8px);
    }
    .card:hover { transform: translateY(-3px); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1); border-color: hsl(var(--primary) / 0.3); }
    .create-post { display: flex; align-items: center; gap: 1rem; }
    .create-post input {
      flex: 1; background: hsl(var(--muted)); border: 1px solid hsl(var(--border));
      border-radius: 2rem; padding: 0.75rem 1.5rem; color: hsl(var(--foreground));
      outline: none;
    }
    .post-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .post-info h4 { font-weight: 600; }
    .post-info span { font-size: 0.85rem; color: var(--text-secondary); }
    .post-actions { display: flex; gap: 0.8rem; margin-top: 1rem; }
    .post-action {
      flex: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      padding: 0.6rem; border-radius: 0.8rem; cursor: pointer; background: hsl(var(--muted));
      border: 1px solid hsl(var(--border)); font-weight: 500;
    }
    .post-action:hover { background: hsl(var(--primary)); color: white; }
    .difficulty-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
    .beginner { background: hsl(var(--success) / 0.1); color: hsl(var(--success)); border: 1px solid hsl(var(--success) / 0.2); }
    .intermediate { background: hsl(var(--warning) / 0.1); color: hsl(var(--warning)); border: 1px solid hsl(var(--warning) / 0.2); }
    .advanced { background: hsl(var(--destructive) / 0.1); color: hsl(var(--destructive)); border: 1px solid hsl(var(--destructive) / 0.2); }

    /* === TRENDING NEWS (dynamic) === */
    .trengrid { display: flex; flex-direction: column; gap: 1rem; }
    .news-item {
      padding: 0.8rem; border-radius: 0.8rem; background: hsl(var(--muted) / 0.3);
      border-left: 3px solid hsl(var(--primary)); cursor: pointer;
    }
    .news-item h4 { font-size: 0.95rem; margin-bottom: 0.2rem; }
    .news-item p { font-size: 0.75rem; color: var(--text-secondary); }

    /* === ARENA / REACTION === */
    .arena-card { background: linear-gradient(135deg, #1e1b4b, #312e81); color: white; border: none; }
    .duel-area { display: flex; align-items: center; justify-content: space-around; margin: 2rem 0; }
    .player { text-align: center; }
    .vs { font-size: 2.5rem; font-weight: 800; text-shadow: 0 0 20px rgba(255,255,255,0.5); }
    .score { font-size: 3rem; font-weight: 700; }
    .btn {
      padding: 0.9rem 2rem; border-radius: 2rem; border: none; font-weight: 600; cursor: pointer;
      background: hsl(var(--primary)); color: white; transition: var(--transition);
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px -5px hsl(var(--primary) / 0.5); }
    .btn-outline { background: transparent; border: 1px solid hsl(var(--border)); color: hsl(var(--foreground)); }
    .reaction-target {
      width: 200px; height: 200px; background: hsl(var(--primary)); border-radius: 50%;
      margin: 2rem auto; display: flex; align-items: center; justify-content: center;
      font-weight: bold; transition: 0.1s; cursor: pointer;
    }
    .reaction-target.ready { background: hsl(var(--success)); transform: scale(1.05); }
    .reaction-target.waiting { background: hsl(var(--warning)); cursor: not-allowed; }

    /* === WIKI AI (chat) === */
    .wiki-messages { height: 250px; overflow-y: auto; background: hsl(var(--muted) / 0.3); border-radius: 0.8rem; padding: 1rem; margin-bottom: 1rem; }
    .wiki-message { margin-bottom: 0.8rem; font-size: 0.9rem; padding: 0.5rem; border-radius: 0.8rem; background: var(--bg-card); border: 1px solid hsl(var(--border)); }
    .wiki-message.system { background: hsl(var(--primary) / 0.1); border-color: hsl(var(--primary)); }
    .chat-input { display: flex; gap: 0.5rem; }

    /* === FOOTER === */
    .footer {
      background: var(--bg-card); border-top: 1px solid hsl(var(--border));
      padding: 3rem 1.5rem 1.5rem; margin-top: 3rem;
    }
    .footer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem; max-width: 1440px; margin: 0 auto; }
    .footer-section h4 { margin-bottom: 1rem; }
    .footer-section li { list-style: none; margin-bottom: 0.5rem; }
    .footer-section a { color: var(--text-secondary); text-decoration: none; cursor: pointer; }
    .footer-section a:hover { color: hsl(var(--primary)); }

    /* === TOAST === */
    .toast-container { position: fixed; bottom: 2rem; right: 2rem; z-index: 3000; }
    .toast {
      background: var(--bg-card); border-left: 4px solid hsl(var(--primary)); border-radius: 0.8rem;
      padding: 1rem 1.5rem; margin-bottom: 0.8rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.2);
      display: flex; align-items: center; gap: 1rem; animation: slideIn 0.3s;
    }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    /* === hidden pages === */
    .page { display: none; }
    .page.active { display: block; }
    .glass-card { background: hsl(var(--background) / 0.7); backdrop-filter: blur(12px); border: 1px solid hsl(var(--border) / 0.2); border-radius: var(--radius); }
    .live-indicator { display: flex; height: 0.75rem; width: 0.75rem; position: relative; }
  </style>
</head>
<body>
  <!-- HEADER (merged) -->
  <header class="header">
    <div class="logo-area">
      <div class="logo" onclick="app.navigate('home')">ThumbsApp</div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="globalSearch" placeholder="Search games, players..." onkeyup="app.search(this.value)">
      </div>
    </div>
    <div class="nav-menu">
      <div class="nav-item active" onclick="app.navigate('home')">Home</div>
      <div class="nav-item" onclick="app.navigate('arena')">Arena</div>
      <div class="nav-item" onclick="app.navigate('tournaments')">Tourneys</div>
      <div class="nav-item" onclick="app.navigate('wiki')">Wiki AI</div>
    </div>
    <div class="user-menu">
      <div class="icon-btn" onclick="app.showNotif()"><i class="fas fa-bell"></i><span class="badge" id="notifBadge">3</span></div>
      <div class="icon-btn" onclick="app.showMessages()"><i class="fas fa-envelope"></i><span class="badge" id="msgBadge">2</span></div>
      <div class="avatar" onclick="app.toggleUserMenu()" id="userAvatar"><span id="avatarInitial">P</span></div>
      <div class="dropdown" id="userDropdown">
        <div class="dropdown-item" onclick="app.showProfile()"><i class="fas fa-user"></i> Profile</div>
        <div class="dropdown-item" onclick="app.showWallet()"><i class="fas fa-wallet"></i> Wallet</div>
        <div class="dropdown-item" onclick="app.showSettings()"><i class="fas fa-cog"></i> Settings</div>
        <div class="theme-colors" style="display:flex; gap:0.5rem; padding:0.8rem;">
          <div class="theme-dot blue" onclick="app.setTheme('blue')"></div>
          <div class="theme-dot pink" onclick="app.setTheme('pink')"></div>
          <div class="theme-dot green" onclick="app.setTheme('green')"></div>
        </div>
        <div class="dropdown-item" onclick="app.toggleDarkMode()"><i class="fas fa-moon"></i> Dark/Light</div>
        <div class="dropdown-item" onclick="app.logout()" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</div>
        <div class="dropdown-item" onclick="app.showLogin()" id="loginBtn" style="display:none;"><i class="fas fa-sign-in-alt"></i> Login</div>
      </div>
    </div>
  </header>

  <!-- MAIN GRID (three columns) -->
  <div class="main-grid">
    <!-- LEFT SIDEBAR -->
    <aside class="left-sidebar sidebar">
      <div class="sidebar-section"><div class="sidebar-title">Social</div>
        <div class="sidebar-item" onclick="app.showFriends()"><i class="fas fa-user-friends"></i> Friends <span class="badge side" id="friendsBadge">0</span></div>
        <div class="sidebar-item" onclick="app.showMessages()"><i class="fas fa-comment"></i> Messages <span class="badge side" id="messagesBadge">0</span></div>
      </div>
      <div class="sidebar-section"><div class="sidebar-title">Gaming</div>
        <div class="sidebar-item" onclick="app.navigate('arena')"><i class="fas fa-video"></i> Live Arenas <span class="badge side danger" id="liveCount">3</span></div>
        <div class="sidebar-item" onclick="app.navigate('tournaments')"><i class="fas fa-trophy"></i> Tournaments</div>
      </div>
    </aside>

    <!-- MAIN CONTENT (pages) -->
    <main class="feed" id="mainContent">
      <!-- HOME PAGE (with trending news) -->
      <div id="home-page" class="page active">
        <div class="card create-post">
          <div class="avatar small" id="postAvatar">P</div>
          <input type="text" placeholder="Create a challenge, share victory..." onclick="app.openCreateModal()">
        </div>
        <!-- Trending News (dynamic) -->
        <div class="card">
          <h3><i class="fas fa-fire" style="color:hsl(var(--primary));"></i> Trending News</h3>
          <div class="trengrid" id="trendingNewsContainer"></div>
        </div>
        <!-- Feed container -->
        <div id="feedContainer"><div class="spinner"></div></div>
        <button class="btn btn-outline" style="width:100%; margin-top:1rem;" onclick="app.loadMore()" id="loadMoreBtn">Load More</button>
      </div>

      <!-- ARENA PAGE (reaction duel) -->
      <div id="arena-page" class="page">
        <div class="card arena-card">
          <h2>‚ö° REACTION DUEL</h2>
          <div class="duel-area">
            <div class="player"><div class="avatar large" id="player1Avatar">P</div><h3 id="player1Name">ProGamer</h3><div class="score" id="scoreA">0</div></div>
            <div class="vs">VS</div>
            <div class="player"><div class="avatar large" id="player2Avatar">G</div><h3 id="player2Name">GameMaster</h3><div class="score" id="scoreB">0</div></div>
          </div>
          <div class="game-controls">
            <button class="btn" onclick="app.startGame()" id="startGameBtn"><i class="fas fa-play"></i> Start</button>
            <button class="btn" onclick="app.playRound()" id="playRoundBtn" disabled><i class="fas fa-bolt"></i> React!</button>
          </div>
          <div class="reaction-game-area" id="reactionGameArea" style="display:none;">
            <div class="reaction-target" id="reactionTarget" onclick="app.handleReaction()"><span id="targetText">READY</span></div>
          </div>
          <div style="display:flex; justify-content:space-between; margin-top:1rem;"><span><i class="fas fa-users"></i> <span id="viewerCount">234</span> watching</span><span><i class="fas fa-gift"></i> Prize: <span id="prizeAmount">20</span> THB</span></div>
        </div>
      </div>

      <!-- TOURNAMENTS PAGE (placeholder but functional) -->
      <div id="tournaments-page" class="page">
        <div class="card"><h2>üèÜ Active Tournaments</h2><div id="tournamentsList"><p class="glass-card" style="padding:2rem; text-align:center;">Join a tournament via home feed</p></div></div>
      </div>

      <!-- WIKI AI PAGE (fully working) -->
      <div id="wiki-page" class="page">
        <div class="card">
          <h2><i class="fas fa-robot"></i> Wiki AI Assistant</h2>
          <div class="wiki-messages" id="wikiMessages">
            <div class="wiki-message system"><strong>AI:</strong> Hello! Ask me about games, strategies, or tips.</div>
          </div>
          <div class="chat-input">
            <input type="text" id="wikiInput" placeholder="e.g., reaction duel tips, chess strategy..." onkeypress="app.handleWikiKeypress(event)">
            <button class="btn" onclick="app.askWiki()"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>
      </div>
    </main>

    <!-- RIGHT SIDEBAR (live, wallet, chat) -->
    <aside class="right-sidebar sidebar">
      <div class="sidebar-section"><div class="sidebar-title">Live Now</div><div id="liveStreams"></div></div>
      <div class="sidebar-section"><div class="sidebar-title">Wallet</div><div class="wallet-card card"><div>Balance</div><div class="balance" id="walletBalance">100 THB</div><button class="btn" style="width:100%;" onclick="app.showDeposit()">Deposit</button></div></div>
      <div class="sidebar-section"><div class="sidebar-title">Live Chat</div><div class="chat-messages" id="chatMessages" style="height:150px; overflow-y:auto; background:hsl(var(--muted)/0.3); padding:0.5rem; border-radius:0.8rem;"></div><div class="chat-input" style="margin-top:0.5rem;"><input type="text" id="chatInput" placeholder="Chat..." onkeypress="app.handleChatKeypress(event)"><button class="btn" style="padding:0.5rem 1rem;" onclick="app.sendChat()">Send</button></div></div>
      <div class="sidebar-section"><div class="sidebar-title">Achievements</div><div class="badges-grid" id="achievementsList"></div></div>
    </aside>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-grid">
      <div class="footer-section"><h4>Support</h4><ul><li><a onclick="app.showDonation()">Donation</a></li><li><a onclick="app.showHelp()">Help</a></li></ul></div>
      <div class="footer-section"><h4>Company</h4><ul><li><a onclick="app.showTerms()">Terms</a></li><li><a onclick="app.showPrivacy()">Privacy</a></li></ul></div>
      <div class="footer-section"><h4>Platform</h4><ul><li><a onclick="app.navigate('home')">Home</a></li><li><a onclick="app.navigate('arena')">Arena</a></li></ul></div>
      <div class="footer-section"><h4>Legal</h4><ul><li><a onclick="app.showAgeVerification()">Age verification</a></li></ul></div>
    </div>
    <div style="text-align:center; margin-top:2rem; color:var(--text-secondary);">¬© 2026 ThumbsApp ¬∑ unified edition</div>
  </footer>

  <!-- MODALS (auth, create, donation) simplified but functional -->
  <div class="modal" id="authModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(8px); z-index:2000; align-items:center; justify-content:center;">
    <div class="modal-content glass-card" style="max-width:400px; width:90%; padding:2rem;">
      <div class="modal-header"><h2 id="authTitle">Login</h2><button class="close-btn" onclick="app.closeModal('authModal')" style="background:none; border:none; font-size:2rem;">&times;</button></div>
      <div id="loginForm"><div class="form-group"><label>Email</label><input type="email" id="loginEmail" class="w-full" style="width:100%; padding:0.8rem;"></div><div class="form-group"><label>Password</label><input type="password" id="loginPassword" style="width:100%; padding:0.8rem;"></div><button class="btn" style="width:100%;" onclick="app.login()">Sign In</button><p style="margin-top:1rem;">Don't have an account? <a onclick="app.showRegister()">Register</a></p></div>
      <div id="registerForm" style="display:none;"><div class="form-group"><label>Username</label><input id="regUsername" style="width:100%;"></div><div class="form-group"><label>Email</label><input id="regEmail" style="width:100%;"></div><div class="form-group"><label>Password</label><input type="password" id="regPassword" style="width:100%;"></div><button class="btn" style="width:100%;" onclick="app.register()">Create</button></div>
    </div>
  </div>
  <div class="modal" id="createModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(8px); align-items:center; justify-content:center;">
    <div class="modal-content glass-card" style="max-width:400px; padding:2rem;"><h2>Create Challenge</h2><input type="text" id="challengeTitle" placeholder="Title" style="width:100%; margin:0.5rem 0;"><input type="number" id="challengeEntryFee" value="10" style="width:100%;"><button class="btn" onclick="app.createPost()">Post</button></div>
  </div>
  <div class="modal" id="donationModal" style="display:none; inset:0; position:fixed; background:rgba(0,0,0,0.7); align-items:center; justify-content:center;"><div class="modal-content glass-card" style="padding:2rem;"><h3>Donate</h3><input type="number" id="donateAmount" value="10"><button onclick="app.donate()">Send</button></div></div>

  <!-- TOAST CONTAINER -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    (function() {
      // ---------- DATABASE (merged mock data) ----------
      class Database {
        constructor() {
          this.users = new Map(); this.posts = new Map(); this.tournaments = new Map(); this.achievements = new Map();
          this.initSample();
        }
        initSample() {
          this.users.set('1', { id:'1', username:'ProGamer', email:'pro@ex.com', password:'pass', country:'US', level:25, xp:12450, balance:2450, achievements:['first_win'], friends:['2'], wins:20, losses:3 });
          this.users.set('2', { id:'2', username:'GameMaster', email:'master@ex.com', password:'pass', country:'SG', level:22, xp:11230, balance:1800, achievements:[], friends:['1'], wins:15, losses:5 });
          this.posts.set('1', { id:'1', userId:'1', author:'ProGamer', content:'Reaction duel 10 THB', game:'Reaction Duel', entryFee:10, difficulty:'intermediate', likes:12, comments:2, shares:0, timestamp:Date.now()-200000 });
          this.posts.set('2', { id:'2', userId:'2', author:'GameMaster', content:'Speed chess 20 THB', game:'Speed Chess', entryFee:20, difficulty:'advanced', likes:8, comments:1, shares:3, timestamp:Date.now()-900000 });
          this.achievements.set('first_win', { id:'first_win', name:'First Win', icon:'üèÜ' });
        }
        getUser(id) { return this.users.get(id); }
        getUserByEmail(e) { return Array.from(this.users.values()).find(u=>u.email===e); }
        createUser(d) { let id=Date.now()+''; let u={id,...d, balance:100, level:1, xp:0, achievements:[], friends:[]}; this.users.set(id,u); return u; }
        getPosts(limit, offset) { return Array.from(this.posts.values()).sort((a,b)=>b.timestamp-a.timestamp).slice(offset, offset+limit); }
        createPost(p) { p.id=Date.now()+''; p.timestamp=Date.now(); p.likes=0; p.comments=0; this.posts.set(p.id, p); return p; }
        likePost(id) { let p=this.posts.get(id); if(p){p.likes++;} return p; }
      }
      // ---------- GAME ENGINE (reaction) ----------
      class GameEngine {
        constructor() { this.activeGames=new Map(); }
        createGame(p1,p2,fee=10) { let id='game'+Date.now(); let g={id, player1:p1,player2:p2,score1:0,score2:0, status:'active', entryFee:fee, winner:null}; this.activeGames.set(id,g); return g; }
        playRound(id,pid) { let g=this.activeGames.get(id); if(!g||g.status!='active') return null; let score=Math.floor(Math.random()*8)+2; if(pid===g.player1.id) g.score1+=score; else g.score2+=score; if(g.score1>=50||g.score2>=50) { g.status='finished'; g.winner=g.score1>=50?g.player1:g.player2; } return g; }
      }
      // ---------- WIKI AI ENGINE (realistic answers) ----------
      class WikiAI {
        constructor() { this.kb={ 'reaction duel tips':'Focus on peripheral vision. Pro avg 180ms.','speed chess':'Use premoves and practice endgames.','memory match':'Use loci method.','tournament':'Check in 1h early.' }; }
        query(q) {
          q=q.toLowerCase(); let ans='I found info about gaming.'; for(let k in this.kb) if(q.includes(k.split(' ')[0])) ans=this.kb[k];
          return { answer:ans, sources:['wiki'], time:120 };
        }
      }

      // ---------- MAIN APP (merged from all three files) ----------
      window.app = new class ThumbsApp {
        constructor() {
          this.db = new Database(); this.gameEngine = new GameEngine(); this.wikiAI = new WikiAI();
          this.currentUser = null; this.currentPage = 'home'; this.postOffset = 0; this.postsPerPage = 3;
          this.currentGameId = null; this.reactionTargetTimeout = null; this.reactionStart = null;
          this.chatHistory = []; this.newsArticles = [
            { title:'ProGamer wins 10k THB', source:'ESPN', time:'2h' },
            { title:'Memory Match update', source:'GameSpot', time:'5h' },
            { title:'Reaction Duel 2.0 beta', source:'Thumbs', time:'1d' }
          ];
          this.init();
        }
        init() {
          this.checkAuth(); this.renderFeed(); this.updateSidebars(); this.renderTrendingNews(); this.setupListeners();
          setInterval(()=>this.updateLiveStreams(), 15000); setInterval(()=>this.updateViewerCount(), 10000);
        }
        setupListeners() { window.onclick=(e)=> { if(!e.target.closest('.user-menu')) document.getElementById('userDropdown')?.classList.remove('show'); }; }
        checkAuth() { let saved=localStorage.getItem('thumbsapp_user'); if(saved) { this.currentUser=JSON.parse(saved); this.updateUIForAuth(); }
          else { setTimeout(()=>{ this.currentUser=this.db.getUser('1'); this.updateUIForAuth(); this.renderFeed(); },300); }
        }
        updateUIForAuth() {
          let u=this.currentUser; let avInitial=document.getElementById('avatarInitial'); let postAv=document.getElementById('postAvatar');
          if(u) { avInitial.textContent=u.username[0].toUpperCase(); if(postAv) postAv.textContent=u.username[0]; 
            document.getElementById('walletBalance').innerText=u.balance+' THB'; document.getElementById('player1Name').innerText=u.username;
            let opp=Array.from(this.db.users.values()).find(x=>x.id!==u.id); if(opp) { document.getElementById('player2Name').innerText=opp.username; }
            document.getElementById('loginBtn').style.display='none'; document.getElementById('logoutBtn').style.display='flex';
          } else {
            avInitial.textContent='G'; document.getElementById('walletBalance').innerText='0 THB';
            document.getElementById('loginBtn').style.display='flex'; document.getElementById('logoutBtn').style.display='none';
          }
        }
        navigate(p) {
          document.querySelectorAll('.page').forEach(el=>el.classList.remove('active'));
          document.getElementById(p+'-page').classList.add('active');
          this.currentPage=p; if(p==='wiki') this.renderWiki();
        }
        renderFeed() {
          let cont=document.getElementById('feedContainer'); if(!cont) return;
          let posts=this.db.getPosts(this.postsPerPage, this.postOffset);
          if(posts.length===0) { cont.innerHTML='<div class="card">No posts yet</div>'; return; }
          let html=''; for(let p of posts) { html+=`<div class="card"><div class="post-header"><div class="avatar small">${p.author[0]}</div><div><h4>${p.author}</h4><span>${this.formatTime(p.timestamp)}</span></div></div><div>${p.content}</div><div><span class="difficulty-badge ${p.difficulty}">${p.difficulty}</span></div><div class="post-actions"><div class="post-action" onclick="app.likePost('${p.id}')"><i class="fas fa-thumbs-up"></i> ${p.likes}</div><div class="post-action" onclick="app.joinChallenge('${p.id}')">Join</div></div></div>`; }
          cont.innerHTML=html;
        }
        likePost(id) { this.db.likePost(id); this.renderFeed(); this.showToast('Liked!'); }
        joinChallenge(id) { if(!this.currentUser) { this.showLogin(); return; } let post=this.db.posts.get(id); if(post&&post.entryFee<=this.currentUser.balance) { this.db.createTransaction?.({userId:this.currentUser.id, amount:post.entryFee}); this.showToast('Joined challenge!'); } else this.showToast('insufficient balance','error'); }
        createPost() { if(!this.currentUser) { this.showLogin(); return; } let title=document.getElementById('challengeTitle')?.value||'demo'; let fee=parseInt(document.getElementById('challengeEntryFee')?.value)||10; let p=this.db.createPost({userId:this.currentUser.id, author:this.currentUser.username, content:title, game:'Reaction Duel', entryFee:fee, difficulty:'beginner'}); this.postOffset=0; this.renderFeed(); this.closeModal('createModal'); this.showToast('Challenge created'); }
        loadMore() { this.postOffset+=this.postsPerPage; this.renderFeed(); }

        // Trending News dynamic
        renderTrendingNews() { let cont=document.getElementById('trendingNewsContainer'); if(cont) cont.innerHTML=this.newsArticles.map(n=>`<div class="news-item" onclick="app.showToast('${n.title}')"><h4>üî• ${n.title}</h4><p>${n.source} ¬∑ ${n.time}</p></div>`).join(''); }

        // WIKI AI
        askWiki() { let inp=document.getElementById('wikiInput'); let q=inp.value.trim(); if(!q) return; let msgBox=document.getElementById('wikiMessages'); msgBox.innerHTML+=`<div class="wiki-message"><strong>You:</strong> ${q}</div>`; inp.value=''; let res=this.wikiAI.query(q); setTimeout(()=>{ msgBox.innerHTML+=`<div class="wiki-message system"><strong>AI:</strong> ${res.answer} <small>${res.time}ms</small></div>`; msgBox.scrollTop=msgBox.scrollHeight; },300); }
        handleWikiKeypress(e) { if(e.key==='Enter') this.askWiki(); }

        // ARENA reaction game
        startGame() { if(!this.currentUser) { this.showLogin(); return; } let opp=Array.from(this.db.users.values()).find(u=>u.id!==this.currentUser.id); if(!opp){ this.showToast('no opponent'); return; } let g=this.gameEngine.createGame(this.currentUser, opp, 10); this.currentGameId=g.id; document.getElementById('startGameBtn').disabled=true; document.getElementById('playRoundBtn').disabled=false; document.getElementById('reactionGameArea').style.display='block'; this.startReactionRound(); }
        startReactionRound() { let t=document.getElementById('reactionTarget'); t.classList.add('waiting'); t.innerText='WAIT'; clearTimeout(this.reactionTargetTimeout); this.reactionTargetTimeout=setTimeout(()=>{ t.classList.remove('waiting'); t.classList.add('ready'); t.innerText='CLICK!'; this.reactionStart=Date.now(); }, Math.random()*2000+1000); }
        handleReaction() { if(!this.currentGameId) return; let t=document.getElementById('reactionTarget'); if(t.classList.contains('ready')) { let rt=Date.now()-this.reactionStart; this.playRound(rt); t.classList.remove('ready'); this.startReactionRound(); } else { this.showToast('Too early!','error'); clearTimeout(this.reactionTargetTimeout); this.startReactionRound(); } }
        playRound(rt) { let g=this.gameEngine.playRound(this.currentGameId, this.currentUser.id); if(g) { document.getElementById('scoreA').innerText=g.score1; document.getElementById('scoreB').innerText=g.score2; if(g.status==='finished') { document.getElementById('startGameBtn').disabled=false; document.getElementById('playRoundBtn').disabled=true; document.getElementById('reactionGameArea').style.display='none'; let win=(g.winner?.id===this.currentUser.id); let prize=g.entryFee*2*0.9; if(win) { this.currentUser.balance+=prize; this.showToast(`You win +${prize} THB`,'success'); } else this.showToast('You lose','error'); this.updateUIForAuth(); } }
        }

        // Chat
        sendChat() { let inp=document.getElementById('chatInput'); let msg=inp.value.trim(); if(!msg||!this.currentUser) return; this.chatHistory.push({user:this.currentUser.username, msg}); inp.value=''; this.updateChat(); }
        handleChatKeypress(e) { if(e.key==='Enter') this.sendChat(); }
        updateChat() { let cont=document.getElementById('chatMessages'); if(!cont) return; cont.innerHTML=this.chatHistory.slice(-5).map(c=>`<div><strong>${c.user}:</strong> ${c.msg}</div>`).join(''); }

        // Sidebars
        updateSidebars() { this.updateLiveStreams(); this.updateLeaderboardSidebar(); this.updateChat(); this.updateAchievements(); }
        updateLiveStreams() { let cont=document.getElementById('liveStreams'); let lc=document.getElementById('liveCount'); if(cont) cont.innerHTML=`<div class="sidebar-item" onclick="app.navigate('arena')"><span class="live-badge" style="background:red; color:white; padding:2px 6px; border-radius:12px;">LIVE</span> Reaction Duel <span style="margin-left:auto;">45</span></div><div class="sidebar-item">Speed Chess <span>32</span></div>`; if(lc) lc.innerText='2'; }
        updateLeaderboardSidebar() { let cont=document.getElementById('sidebarLeaderboard'); if(cont) cont.innerHTML=`<div class="leaderboard-item"><span>1. ProGamer</span><span>12450</span></div><div class="leaderboard-item"><span>2. GameMaster</span><span>11230</span></div>`; }
        updateAchievements() { let cont=document.getElementById('achievementsList'); let achs=Array.from(this.db.achievements.values()).slice(0,3); if(cont) cont.innerHTML=achs.map(a=>`<div class="badge-item">${a.icon} ${a.name}</div>`).join(''); }

        // Auth
        showLogin() { document.getElementById('authModal').style.display='flex'; document.getElementById('loginForm').style.display='block'; document.getElementById('registerForm').style.display='none'; }
        showRegister() { document.getElementById('authModal').style.display='flex'; document.getElementById('loginForm').style.display='none'; document.getElementById('registerForm').style.display='block'; }
        login() { let em=document.getElementById('loginEmail')?.value; let pw=document.getElementById('loginPassword')?.value; let u=this.db.getUserByEmail(em); if(u&&pw==='pass') { this.currentUser=u; localStorage.setItem('thumbsapp_user',JSON.stringify(u)); this.closeModal('authModal'); this.updateUIForAuth(); this.showToast('Welcome'); } else this.showToast('Invalid','error'); }
        register() { let name=document.getElementById('regUsername')?.value; if(!name) return; let newU=this.db.createUser({username:name, email:name+'@x', password:'pass', country:'US'}); this.currentUser=newU; localStorage.setItem('thumbsapp_user',JSON.stringify(newU)); this.closeModal('authModal'); this.updateUIForAuth(); this.showToast('Registered'); }
        logout() { this.currentUser=null; localStorage.removeItem('thumbsapp_user'); this.updateUIForAuth(); this.showToast('Logged out'); this.showLogin(); }
        showProfile() { this.showToast('Profile: '+this.currentUser?.username); document.getElementById('userDropdown').classList.remove('show'); }
        showWallet() { this.showToast('Balance: '+this.currentUser?.balance); }
        showSettings() { this.showToast('Settings panel'); }
        toggleDarkMode() { document.body.classList.toggle('dark'); }
        setTheme(c) { this.showToast('Theme '+c); }
        showDeposit() { this.showToast('Deposit modal (simulated)'); }
        showDonation() { document.getElementById('donationModal').style.display='flex'; }
        donate() { let am=document.getElementById('donateAmount')?.value; if(am&&this.currentUser) { this.currentUser.balance-=parseInt(am); this.updateUIForAuth(); this.closeModal('donationModal'); this.showToast('Donated'); } }
        openCreateModal() { if(!this.currentUser) this.showLogin(); else document.getElementById('createModal').style.display='flex'; }
        closeModal(id) { document.getElementById(id).style.display='none'; }
        showToast(m,t='info') { let c=document.getElementById('toastContainer'); let to=document.createElement('div'); to.className='toast'; to.innerHTML=`<span>${m}</span>`; c.appendChild(to); setTimeout(()=>to.remove(),2500); }
        formatTime(ts) { let s=Math.floor((Date.now()-ts)/1000); return s<60?'now':s<3600?Math.floor(s/60)+'m ago':'1h ago'; }
        toggleUserMenu() { document.getElementById('userDropdown').classList.toggle('show'); }
        showMessages() { this.showToast('Messages'); }
        showNotif() { this.showToast('üîî Notifications'); }
        showFriends() { this.showToast('Friends list'); }
        showHelp() { this.showToast('Help'); }
        showTerms() { this.showToast('Terms'); }
        showPrivacy() { this.showToast('Privacy'); }
        showAgeVerification() { this.showToast('Age verified: 18+'); }
        updateViewerCount() { let v=document.getElementById('viewerCount'); if(v) v.innerText=Math.floor(Math.random()*300+200); }
        search(v) { if(v.length>2) this.showToast('Search for "'+v+'"'); }
      };
    })();
  </script>
</body>
</html>
